"use strict";const{app:i,BrowserWindow:u,ipcMain:s}=require("electron"),m=require("node:path"),{exec:c}=require("child_process"),f=require("../store/configStore");s.handle("get-config",()=>f.getConfig());s.handle("save-config",(n,l)=>f.saveConfig(l));s.handle("check-cloudflared",()=>new Promise((n,l)=>{c("cloudflared --version",(e,r,a)=>{e||a?(console.log("cloudflared not found, starting installation..."),c("winget install --id  Cloudflare.cloudflared",(t,d,o)=>{t||o?(console.log("Error installing cloudflared:",o||t.message),l("Installation failed")):(console.log("cloudflared installation successful"),i.relaunch(),i.exit(),n("cloudflared installed and app restarted"))})):(console.log("cloudflared Version:",r.trim()),n("cloudflared is already installed"))})}));s.on("window-control",(n,l)=>{const e=u.getFocusedWindow();e&&(l==="minimize"?e.minimize():l==="maximize"?e.isMaximized()?e.unmaximize():e.maximize():l==="close"&&e.close())});s.handle("start-tunnel",(n,l)=>new Promise((e,r)=>{const a=`cloudflared.exe service install ${l}`;c(a,(t,d,o)=>{t?(console.error(`Error: ${o}`),r(`Failed to start tunnel: ${o}`)):(console.log(`Success: ${d}`),e(`Tunnel started successfully: ${d}`))})}));i.whenReady().then(()=>{const n=new u({title:"Main window",frame:!1,titleBarStyle:"hidden",width:1200,height:800,webPreferences:{preload:m.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0}});process.env.VITE_DEV_SERVER_URL?n.loadURL(process.env.VITE_DEV_SERVER_URL):n.loadFile("dist/index.html"),n.webContents.openDevTools()});i.on("window-all-closed",()=>{process.platform!=="darwin"&&i.quit()});
