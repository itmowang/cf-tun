"use strict";const{app:d,BrowserWindow:u,ipcMain:t}=require("electron"),m=require("node:path"),{exec:c}=require("child_process"),f=require("../store/configStore");t.handle("get-config",()=>f.getConfig());t.handle("save-config",(n,l)=>f.saveConfig(l));t.handle("check-cloudflared",()=>new Promise((n,l)=>{c("cloudflared --version",(e,r,a)=>{e||a?(console.log("cloudflared not found, starting installation..."),c("winget install --id  Cloudflare.cloudflared",(i,s,o)=>{i||o?(console.log("Error installing cloudflared:",o||i.message),l("Installation failed")):(console.log("cloudflared installation successful"),d.relaunch(),d.exit(),n("cloudflared installed and app restarted"))})):(console.log("cloudflared Version:",r.trim()),n("cloudflared is already installed"))})}));t.on("window-control",(n,l)=>{const e=u.getFocusedWindow();e&&(l==="minimize"?e.minimize():l==="maximize"?e.isMaximized()?e.unmaximize():e.maximize():l==="close"&&e.close())});t.handle("start-tunnel",(n,l)=>new Promise((e,r)=>{const a=`cloudflared tunnel run --token ${l}`;c(a,(i,s,o)=>{i?(console.error(`Error: ${o}`),r(`Failed to start tunnel: ${o}`)):(console.log(`Success: ${s}`),e(`Tunnel started successfully: ${s}`))})}));t.handle("stop-tunnel",(n,l)=>new Promise((e,r)=>{const a=process.platform==="win32"?"taskkill /F /IM cloudflared.exe":"pkill cloudflared";c(a,(i,s,o)=>{i?(console.error(`Error stopping tunnel: ${o}`),r(`Failed to stop tunnel: ${o}`)):(console.log(`Tunnel stopped successfully: ${s}`),e(`Tunnel stopped successfully: ${s}`))})}));d.whenReady().then(()=>{const n=new u({title:"Main window",frame:!1,titleBarStyle:"hidden",width:1200,height:800,webPreferences:{preload:m.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0}});process.env.VITE_DEV_SERVER_URL?n.loadURL(process.env.VITE_DEV_SERVER_URL):n.loadFile("dist/index.html"),n.webContents.openDevTools()});d.on("window-all-closed",()=>{process.platform!=="darwin"&&d.quit()});
