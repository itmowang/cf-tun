"use strict";const{app:o,BrowserWindow:d,ipcMain:l}=require("electron"),u=require("node:path"),{exec:a}=require("child_process"),r=require("../configStore");l.handle("check-cloudflared",()=>new Promise((e,i)=>{a("cloudflared --version",(n,c,f)=>{n||f?(console.log("cloudflared not found, starting installation..."),a("winget install --id  Cloudflare.cloudflared",(t,w,s)=>{t||s?(console.log("Error installing cloudflared:",s||t.message),i("Installation failed")):(console.log("cloudflared installation successful"),o.relaunch(),o.exit(),e("cloudflared installed and app restarted"))})):(console.log("cloudflared Version:",c.trim()),e("cloudflared is already installed"))})}));l.on("window-control",(e,i)=>{const n=d.getFocusedWindow();n&&(i==="minimize"?n.minimize():i==="maximize"?n.isMaximized()?n.unmaximize():n.maximize():i==="close"&&n.close())});l.handle("get-config",()=>r.getConfig());l.handle("save-config",(e,i)=>r.saveConfig(i));o.whenReady().then(()=>{const e=new d({title:"Main window",frame:!1,titleBarStyle:"hidden",width:1200,height:800,webPreferences:{preload:u.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0}});process.env.VITE_DEV_SERVER_URL?e.loadURL(process.env.VITE_DEV_SERVER_URL):e.loadFile("dist/index.html"),e.webContents.openDevTools()});o.on("window-all-closed",()=>{process.platform!=="darwin"&&o.quit()});
